DROP VIEW IF EXISTS `purchase_bill_medicine_temp_view_duplicate`;
CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `hosp_app_db`.`purchase_bill_medicine_temp_view_duplicate` AS select `a`.`ID` AS `PURCHASE_BILL_MEDICINE_ID`
,`b`.`MEDICINE_NAME` AS `MEDICINE_NAME`,`a`.`PURCHASE_BILL_MEDICINE_BATCH` AS `PURCHASE_BILL_MEDICINE_BATCH`,`a`.`PURCHASE_BILL_MEDICINE_EXPIRY_MONTH` AS `PURCHASE_BILL_MEDICINE_EXPIRY_MONTH`,`a`.
`PURCHASE_BILL_MEDICINE_EXPIRY_YEAR` AS `PURCHASE_BILL_MEDICINE_EXPIRY_YEAR`,`a`.`PURCHASE_BILL_MEDICINE_MRP` AS `PURCHASE_BILL_MEDICINE_MRP`,`a`.`PURCHASE_BILL_MEDICINE_AMOUNT_AFTER_DISCOUNT` AS 
`PURCHASE_BILL_MEDICINE_AMOUNT_AFTER_DISCOUNT`,`a`.`PURCHASE_BILL_MEDICINE_DISCOUNT` AS `PURCHASE_BILL_MEDICINE_DISCOUNT`,`a`.`PURCHASE_BILL_MEDICINE_FREE_UNITS` AS `PURCHASE_BILL_MEDICINE_FREE_UNITS`,
`a`.`PURCHASE_BILL_MEDICINE_NO_OF_UNITS` AS `PURCHASE_BILL_MEDICINE_NO_OF_UNITS`,`a`.`PURCHASE_BILL_MEDICINE_PACKING` AS `PURCHASE_BILL_MEDICINE_PACKING`,`a`.`PURCHASE_BILL_MEDICINE_PRICE` AS
 `PURCHASE_BILL_MEDICINE_PRICE`,`a`.`PURCHASE_BILL_MEDICINE_QUANTITY` AS `PURCHASE_BILL_MEDICINE_QUANTITY`,`a`.`PURCHASE_BILL_MEDICINE_RETURNED` AS `PURCHASE_BILL_MEDICINE_RETURNED`,`a`.`
 PURCHASE_BILL_MEDICINE_SOLD` AS `PURCHASE_BILL_MEDICINE_SOLD`,`a`.`PURCHASE_BILL_MEDICINE_TOTAL_AMOUNT` AS `PURCHASE_BILL_MEDICINE_TOTAL_AMOUNT`,`a`.`PURCHASE_BILL_MEDICINE_VAT_AMOUNT` AS
  `PURCHASE_BILL_MEDICINE_VAT_AMOUNT`,`a`.`PURCHASE_BILL_MEDICINE_ALERT_COUNT` AS `PURCHASE_BILL_MEDICINE_ALERT_COUNT`,`a`.`PURCHASE_BILL_MEDICINE_VAT_PERCENT` AS `PURCHASE_BILL_MEDICINE_VAT_PERCENT`,
  `a`.`STATUS` AS `STATUS`,`a`.`PURCHASE_BILL_ID` AS `PURCHASE_BILL_ID`,`a`.`MEDICINE_ID` AS `MEDICINE_ID`,`b`.`MEDICINE_CATEGORY_ID` AS `MEDICINE_CATEGORY_ID`,`c`.`MEDICINE_CATEGORY_NAME` AS 
  `MEDICINE_CATEGORY_NAME`,`b`.`MEDICINE_CATEGORY_BY_DOCTOR_ID` AS `MEDICINE_CATEGORY_BY_DOCTOR_ID`,`d`.`MEDICINE_DOCTOR_NAME` AS `MEDICINE_DOCTOR_NAME`,`b`.`MEDICINE_LOCATION_ID` AS 
  `MEDICINE_LOCATION_ID`,`b`.`MEDICINE_DRUGFORMULAE_ID` AS `MEDICINE_DRUGFORMULAE_ID`,`f`.`DRUG_NAME` AS `DRUG_NAME`,`f`.`DRUG_CONTENT` AS `DRUG_CONTENT`,`f`.`HSN_CODE` AS `HSN_CODE`,
  `f`.`MEDICINE_MAX_COUNT` AS `MEDICINE_MAX_COUNT`,`f`.`MEDICINE_MIN_COUNT` AS `MEDICINE_MIN_COUNT`,`b`.`MEDICINE_COMAPANY_ID` AS `MEDICINE_COMAPANY_ID`,`g`.`COMPANY_NAME` AS 
  `COMPANY_NAME`,`a`.`CREATED_BY` AS `CREATED_BY`,`a`.`CREATED_ON` AS `CREATED_ON`,`a`.`PURCHASE_BILL_PURCHASE_MEDICINE_RETURNED` AS `PURCHASE_BILL_PURCHASE_MEDICINE_RETURNED`,
  (((((ifnull(`a`.`PURCHASE_BILL_MEDICINE_QUANTITY`,0) + ifnull(`a`.`PURCHASE_BILL_MEDICINE_FREE_UNITS`,0)) * ifnull(`a`.`PURCHASE_BILL_MEDICINE_NO_OF_UNITS`,0)) + ifnull(`a`.
  `PURCHASE_BILL_MEDICINE_RETURNED`,0)) - ifnull(`a`.`PURCHASE_BILL_MEDICINE_SOLD`,0)) - ifnull(`a`.`PURCHASE_BILL_PURCHASE_MEDICINE_RETURNED`,0)) AS `MEDICINE_AVAILABILITY`,
  `pms`.`SUPPLIER_ID` AS `SUPPLIER_ID`,`sup`.`SUPPLIER_NAME` AS `SUPPLIER_NAME` from (((((((`hosp_app_db`.`purchase_bill_medicines_trn_tbl` `a` join `hosp_app_db`.`medicine_mst_tbl` `b`)
   join `hosp_app_db`.`medicine_category_mst_tbl` `c`) join `hosp_app_db`.`medicine_category_by_doctor_mst_tbl` `d`) join `hosp_app_db`.`drug_formulae_mst_tbl` `f`) join `hosp_app_db`.
   `company_mst_tbl` `g`) join `hosp_app_db`.`purchase_bill_mst_tbl` `pms`) join `hosp_app_db`.`supplier_mst_tbl` `sup`) where ((`a`.`MEDICINE_ID` = `b`.`ID`) and (`pms`.`ID`
    = `a`.`PURCHASE_BILL_ID`) and (`b`.`MEDICINE_CATEGORY_ID` = `c`.`ID`) and (`b`.`MEDICINE_CATEGORY_BY_DOCTOR_ID` = `d`.`ID`) and (`b`.`MEDICINE_DRUGFORMULAE_ID` = `f`.`ID`) 
    and (`b`.`MEDICINE_COMAPANY_ID` = `g`.`ID`) and (`pms`.`SUPPLIER_ID` = `sup`.`ID`));